version: '3.8'

services:
  kairn:
    container_name: kairn
    build: .
    restart: unless-stopped
    volumes:
      - ./app/data:/app/app/data
      - ./app/uploads:/app/app/uploads
    environment:
      - DATABASE_URL=sqlite:///./app/data/kairn.db
      - INVITATION_CODE=${INVITATION_CODE}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    ports:
      - "8000:8000" # Access locally via http://IP:8000 while waiting for Tunnel

  tunnel:
    container_name: cloudflared
    image: cloudflare/cloudflared:latest
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    depends_on:
      - kairn
