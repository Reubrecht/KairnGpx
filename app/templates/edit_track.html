{% extends "base.html" %}

{% block content %}
<div class="min-h-[calc(100vh-64px)] bg-slate-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">

        <div class="text-center mb-10">
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Modifier la Trace</h1>
            <p class="mt-2 text-lg text-slate-600">{{ track.title }}</p>
        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
            <form action="/track/{{ track.id }}/edit" method="post" class="divide-y divide-slate-100">

                <!-- 1. Core Info -->
                <div class="p-8 space-y-6">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                        <span
                            class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-100 text-brand-700 text-sm font-bold">1</span>
                        Informations Générales
                    </h2>

                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Titre de la sortie</label>
                            <input type="text" name="title" value="{{ track.title }}" required
                                class="w-full rounded-lg border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 transition-colors">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                            <textarea name="description" rows="4"
                                class="w-full rounded-lg border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 transition-colors">{{ track.description or '' }}</textarea>
                        </div>

                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-3">Visibilité</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <label class="cursor-pointer group">
                                        <input type="radio" name="visibility" value="public" class="peer sr-only" {% if
                                            track.visibility.value=='public' %}checked{% endif %}>
                                        <div
                                            class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md peer-checked:bg-emerald-50 peer-checked:border-emerald-500 peer-checked:text-emerald-700 transition-all">
                                            <span class="text-sm font-semibold">Publique</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer group">
                                        <input type="radio" name="visibility" value="unlisted" class="peer sr-only" {%
                                            if track.visibility.value=='unlisted' %}checked{% endif %}>
                                        <div
                                            class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md peer-checked:bg-amber-50 peer-checked:border-amber-500 peer-checked:text-amber-700 transition-all">
                                            <span class="text-sm font-semibold">Non répertoriée</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer group">
                                        <input type="radio" name="visibility" value="private" class="peer sr-only" {% if
                                            track.visibility.value=='private' %}checked{% endif %}>
                                        <div
                                            class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md peer-checked:bg-slate-100 peer-checked:border-slate-500 peer-checked:text-slate-700 transition-all">
                                            <span class="text-sm font-semibold">Privée</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-3">Type d'activité</label>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    {% for status in status_options %}
                                    {% set status_label = status %}
                                    {% if status == 'OFFICIAL_RACE' %}{% set status_label = 'Course Officielle' %}
                                    {% elif status == 'TRAINING' %}{% set status_label = 'Entraînement' %}
                                    {% endif %}
                                    <label class="cursor-pointer group">
                                        <input type="radio" name="status_val" value="{{ status }}" class="peer sr-only"
                                            {% if track.status.value==status %}checked{% endif %}>
                                        <div
                                            class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md peer-checked:bg-brand-50 peer-checked:border-brand-500 peer-checked:text-brand-700 transition-all">
                                            <span class="text-sm font-semibold">{{ status_label }}</span>
                                        </div>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Technical & Terrain -->
                <div class="p-8 space-y-6 bg-slate-50/30">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                        <span
                            class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-100 text-brand-700 text-sm font-bold">2</span>
                        Détails Techniques
                    </h2>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-3">Technicité</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                                {% for tech in technicity_options %}
                                {% set tech_color_class = 'peer-checked:bg-brand-50 peer-checked:border-brand-500
                                peer-checked:text-brand-700' %}
                                {% if tech == 'ROULANT' %}{% set tech_color_class = 'peer-checked:bg-emerald-50
                                peer-checked:border-emerald-500 peer-checked:text-emerald-700' %}
                                {% elif tech == 'PEU_TECHNIQUE' %}{% set tech_color_class = 'peer-checked:bg-green-50
                                peer-checked:border-green-500 peer-checked:text-green-700' %}
                                {% elif tech == 'TECHNIQUE' %}{% set tech_color_class = 'peer-checked:bg-yellow-50
                                peer-checked:border-yellow-500 peer-checked:text-yellow-700' %}
                                {% elif tech == 'TRES_TECHNIQUE' %}{% set tech_color_class = 'peer-checked:bg-orange-50
                                peer-checked:border-orange-500 peer-checked:text-orange-700' %}
                                {% elif tech == 'AERIEN' %}{% set tech_color_class = 'peer-checked:bg-red-50
                                peer-checked:border-red-500 peer-checked:text-red-700' %}
                                {% endif %}
                                <label class="cursor-pointer group">
                                    <input type="radio" name="technicity" value="{{ tech }}" class="peer sr-only" {% if
                                        track.technicity.value==tech %}checked{% endif %}>
                                    <div
                                        class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md {{ tech_color_class }} transition-all">
                                        <span class="text-sm font-semibold">{{ tech | replace('_', ' ') | capitalize
                                            }}</span>
                                    </div>
                                </label>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-3">Terrain Dominant</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                                {% for terr in terrain_options %}
                                <label class="cursor-pointer group">
                                    <input type="radio" name="terrain" value="{{ terr }}" class="peer sr-only" {% if
                                        track.terrain.value==terr %}checked{% endif %}>
                                    <div
                                        class="h-14 w-full bg-white border border-slate-200 rounded-xl flex items-center justify-center text-center hover:shadow-md peer-checked:bg-brand-50 peer-checked:border-brand-500 peer-checked:text-brand-700 transition-all">
                                        <span class="text-sm font-semibold">{{ terr | replace('_', ' ') | capitalize
                                            }}</span>
                                    </div>
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Logistics & Extras -->
                <div class="p-8 space-y-8">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                        <span
                            class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-100 text-brand-700 text-sm font-bold">3</span>
                        Logistique & Autres
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <!-- Scenery / Note Paysage -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-4">Note Paysage</label>
                            <div class="flex items-center gap-2">
                                <div class="flex flex-row-reverse justify-end gap-1 group">
                                    {% for i in range(5, 0, -1) %}
                                    <input type="radio" name="scenery_rating" id="star{{i}}" value="{{i}}"
                                        class="peer sr-only" {% if track.scenery_rating==i %}checked{% endif %}>
                                    <label for="star{{i}}"
                                        class="cursor-pointer text-slate-300 peer-checked:text-amber-400 hover:text-amber-400 peer-hover:text-amber-400 transition-colors">
                                        <svg class="w-10 h-10 transform hover:scale-110 transition-transform"
                                            fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Water Points Stepper -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-4">Points d'Eau</label>
                            <div class="flex items-center w-full max-w-[200px]">
                                <button type="button" onclick="adjustWater(-1)"
                                    class="w-12 h-12 rounded-l-xl bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold text-xl border-r border-slate-200 transition-colors">-</button>
                                <input type="number" name="water_points_count" id="water-input"
                                    value="{{ track.water_points_count }}" min="0"
                                    class="w-full h-12 text-center border-0 bg-slate-50 font-bold text-lg text-slate-700 focus:ring-0"
                                    readonly>
                                <button type="button" onclick="adjustWater(1)"
                                    class="w-12 h-12 rounded-r-xl bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold text-xl border-l border-slate-200 transition-colors">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Action -->
                <div class="p-8 bg-slate-50 border-t border-slate-100 flex items-center justify-end gap-4">
                    <a href="/track/{{ track.id }}" class="text-slate-600 font-medium hover:text-slate-800">Annuler</a>
                    <button type="submit"
                        class="px-8 py-3 bg-brand-600 text-white font-bold rounded-full shadow-lg shadow-brand-500/30 hover:bg-brand-700 hover:shadow-brand-500/40 transform hover:-translate-y-0.5 transition-all">
                        Enregistrer les modifications
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

<script>
    function adjustWater(amount) {
        const input = document.getElementById('water-input');
        let val = parseInt(input.value) || 0;
        val += amount;
        if (val < 0) val = 0;
        input.value = val;
    }
</script>
{% endblock %}