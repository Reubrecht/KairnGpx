{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
        <h1 class="text-3xl font-bold text-slate-800 mb-6">Ajouter une nouvelle trace</h1>

        <form action="/upload" method="post" enctype="multipart/form-data" class="space-y-6">

            <!-- File Upload Area -->
            <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-green-500 transition-colors cursor-pointer"
                id="drop-zone">
                <input type="file" name="file" id="file" class="hidden" accept=".gpx" required>
                <div class="space-y-2">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path
                            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <div class="text-sm text-gray-600">
                        <label for="file"
                            class="font-medium text-green-600 hover:text-green-500 cursor-pointer">Téléverser un
                            fichier</label>
                        ou glisser-déposer
                    </div>
                    <p class="text-xs text-gray-500">GPX jusqu'à 10MB</p>
                    <p id="file-name" class="text-sm font-semibold text-slate-700 mt-2"></p>
                </div>
            </div>

            <!-- Basic Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Titre de la sortie</label>
                    <input type="text" name="title" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2 border">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Type</label>
                    <select name="status_val"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2 border">
                        {% for status in status_options %}
                        <option value="{{ status }}">{{ status }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea name="description" rows="3"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2 border"></textarea>
            </div>

            <!-- Technical Details -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-50 p-6 rounded-lg">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Technicité</label>
                    <select name="technicity"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2 border">
                        {% for tech in technicity_options %}
                        <option value="{{ tech }}">{{ tech }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Terrain Dominant</label>
                    <select name="terrain"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2 border">
                        {% for terr in terrain_options %}
                        <option value="{{ terr }}">{{ terr }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Environment Tags -->
            <div>
                <span class="block text-sm font-medium text-gray-700 mb-2">Environnement</span>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <label
                        class="inline-flex items-center space-x-2 cursor-pointer bg-white p-2 border rounded hover:bg-gray-50">
                        <input type="checkbox" name="is_high_mountain" value="true"
                            class="rounded text-green-600 focus:ring-green-500 h-4 w-4">
                        <span class="text-sm text-gray-700">Haute Montagne</span>
                    </label>
                    <label
                        class="inline-flex items-center space-x-2 cursor-pointer bg-white p-2 border rounded hover:bg-gray-50">
                        <input type="checkbox" name="is_coastal" value="true"
                            class="rounded text-green-600 focus:ring-green-500 h-4 w-4">
                        <span class="text-sm text-gray-700">Côtier</span>
                    </label>
                    <label
                        class="inline-flex items-center space-x-2 cursor-pointer bg-white p-2 border rounded hover:bg-gray-50">
                        <input type="checkbox" name="is_forest" value="true"
                            class="rounded text-green-600 focus:ring-green-500 h-4 w-4">
                        <span class="text-sm text-gray-700">Sous-bois</span>
                    </label>
                    <label
                        class="inline-flex items-center space-x-2 cursor-pointer bg-white p-2 border rounded hover:bg-gray-50">
                        <input type="checkbox" name="is_urban" value="true"
                            class="rounded text-green-600 focus:ring-green-500 h-4 w-4">
                        <span class="text-sm text-gray-700">Urbain</span>
                    </label>
                    <label
                        class="inline-flex items-center space-x-2 cursor-pointer bg-white p-2 border rounded hover:bg-gray-50">
                        <input type="checkbox" name="is_desert" value="true"
                            class="rounded text-green-600 focus:ring-green-500 h-4 w-4">
                        <span class="text-sm text-gray-700">Aride</span>
                    </label>
                </div>
            </div>

            <div class="flex justify-end pt-6">
                <button type="submit"
                    class="bg-green-600 text-white px-8 py-3 rounded-full hover:bg-green-700 shadow-lg font-semibold transition-transform transform hover:-translate-y-0.5">
                    Enregistrer la Trace
                </button>
            </div>

        </form>
    </div>
</div>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file');
    const fileName = document.getElementById('file-name');

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('border-green-500', 'bg-green-50');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('border-green-500', 'bg-green-50');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-green-500', 'bg-green-50');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            updateFileName();
        }
    });

    fileInput.addEventListener('change', updateFileName);

    function updateFileName() {
        if (fileInput.files.length) {
            fileName.textContent = "Fichier sélectionné : " + fileInput.files[0].name;
        }
    }

    // Trigger file input when clicking on drop zone
    dropZone.addEventListener('click', () => fileInput.click());
    // Prevent verify click from triggering twice if clicking specifically on label
    document.querySelector('label[for="file"]').addEventListener('click', (e) => e.stopPropagation());
</script>
{% endblock %}